"use strict";(self.webpackChunkTalkdeskChatSDK=self.webpackChunkTalkdeskChatSDK||[]).push([[196],{21879:function(e,t,i){i.d(t,{XN:function(){return defaultRegister},rP:function(){return defaultRegister}});var s=i(1883);defaultRegister.on=registerWithSpecificEmitter;var r=defaultRegister.handlers={},n=function globalRegister(e,t,i){registerWithSpecificEmitter(s.l_,n,e,t,i)}.handlers={};function defaultRegister(e,t,i,n){registerWithSpecificEmitter(n||s.EM,r,e,t,i)}function registerWithSpecificEmitter(e,t,i,r,n){if(n||(n="feature"),e||(e=s.EM),e.isBuffering(i)){var a=t[n]=t[n]||{};(a[i]=a[i]||[]).push([e,r])}else e.on(i,r)}},81196:function(e,t,i){i.r(t),i.d(t,{Aggregate:function(){return Aggregate}});var s=i(30717),r=i(89247),n=i(21879),a=i(46303),h=i(77311),o=i(80406),u=i(25768),c=i(11249),d=i(83707);class Aggregate extends d.W{constructor(e,t){super(e,t),this.eventsPerMinute=240,this.harvestTimeSeconds=(0,o.Mt)("ins.harvestTimeSeconds")||30,this.eventsPerHarvest=this.eventsPerMinute*this.harvestTimeSeconds/60,this.referrerUrl,this.currentEvents,this.events=[],this.att={},(0,u.L)(this.agentIdentifier,{jsAttributes:this.att}),document.referrer&&(this.referrerUrl=(0,h.f)(document.referrer)),(0,n.XN)("api-setCustomAttribute",((...e)=>this.setCustomAttribute(...e)),"api",this.ee),this.ee.on("feat-ins",(function(){(0,n.XN)("api-addPageAction",((...e)=>this.addPageAction(...e)),void 0,this.ee);var e=new a.o("ins",{onFinished:(...e)=>this.onHarvestFinished(...e)},this);e.harvest.on("ins",((...e)=>this.onHarvestStarted(...e))),e.startTimer(this.harvestTimeSeconds,0)}))}onHarvestStarted(e){const{userAttributes:t,atts:i}=(0,u.C)(this.agentIdentifier);var s={qs:{ua:t,at:i},body:{ins:this.events}};return e.retry&&(this.currentEvents=this.events),this.events=[],s}onHarvestFinished(e){e&&e.sent&&e.retry&&this.currentEvents&&(this.events=this.events.concat(this.currentEvents),this.currentEvents=null)}addPageAction(e,t,i){if(!(this.events.length>=this.eventsPerHarvest)){var n,a,o={};"undefined"!=typeof window&&window.document&&window.document.documentElement&&(n=window.document.documentElement.clientWidth,a=window.document.documentElement.clientHeight);var u={timestamp:e+(0,c.O)(this.agentIdentifier).offset,timeSinceLoad:e/1e3,browserWidth:n,browserHeight:a,referrerUrl:this.referrerUrl,currentUrl:(0,h.f)(""+location),pageUrl:(0,h.f)((0,c.O)(this.agentIdentifier).origin),eventType:"PageAction"};(0,s.D)(u,set),(0,s.D)(this.att,set),i&&"object"==typeof i&&(0,s.D)(i,set),o.actionName=t||"",this.events.push(o)}function set(e,t){o[e]=t&&"object"==typeof t?(0,r.P)(t):t}}setCustomAttribute(e,t,i){this.att[t]=i}}}}]);
//# sourceMappingURL=196.talkdeskchatsdk.js.map