{"version":3,"file":"732.talkdeskchatsdk.js","mappings":"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","sources":["webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/browser-version/firefox-version.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/event-emitter/contextual-ee.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/event-emitter/handle.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/event-listener/event-listener-opts.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/cookie/nav-cookie.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/harvest/harvest-scheduler.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/url/location.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/harvest/harvest.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/util/traverse.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/metrics/metrics.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/timing/start-time.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/timing/stopwatch.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/event-listener/add-e.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/unload/unload.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/util/single.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/url/clean-url.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/url/encode.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/util/feature-base.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/util/get-or-set.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/window/win.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/url/protocol.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/util/obfuscate.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/util/reduce.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/util/s-hash.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/util/stringify.js","webpack://TalkdeskChatSDK/./node_modules/@newrelic/browser-agent-core/common/util/submit-data.js","webpack://TalkdeskChatSDK/./node_modules/lodash._slice/index.js"],"sourcesContent":["/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/* eslint-disable no-useless-escape */\n\nexport var ffVersion = 0\nvar match = navigator.userAgent.match(/Firefox[\\/\\s](\\d+\\.\\d+)/)\nif (match) ffVersion = +match[1]\n// export default { ffVersion }\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { gosNREUM } from '../window/nreum'\nimport { getOrSet } from '../util/get-or-set'\nimport { mapOwn } from '../util/map-own'\n\nvar ctxId = 'nr@context'\n\n// create global emitter instance that can be shared among bundles\nlet nr = gosNREUM()\nvar globalInstance\nif (nr.ee) {\n  globalInstance = nr.ee\n} else {\n  globalInstance = ee(undefined, 'globalEE')\n  nr.ee = globalInstance\n}\n\n// export default ee()\nvar baseEE = ee(undefined, 'baseEE')\n\nexport { baseEE as ee }\n\nexport { globalInstance as global }\n\nfunction EventContext () {}\n\nfunction ee (old, debugId) {\n  var handlers = {}\n  var bufferGroupMap = {}\n  var emitters = {}\n\n  var emitter = {\n    on: addEventListener,\n    addEventListener: addEventListener,\n    removeEventListener: removeEventListener,\n    emit: emit,\n    get: getOrCreate,\n    listeners: listeners,\n    context: context,\n    buffer: bufferEventsByGroup,\n    abort: abortIfNotLoaded,\n    aborted: false,\n    isBuffering: isBuffering,\n    debugId\n  }\n\n  // buffer is associated with a base emitter, since there are two\n  // (global and scoped to the current bundle), it is now part of the emitter\n  if (!old) {\n    emitter.backlog = {}\n  }\n\n  return emitter\n\n  function context (contextOrStore) {\n    if (contextOrStore && contextOrStore instanceof EventContext) {\n      return contextOrStore\n    } else if (contextOrStore) {\n      return getOrSet(contextOrStore, ctxId, getNewContext)\n    } else {\n      return getNewContext()\n    }\n  }\n\n  function emit (type, args, contextOrStore, force, bubble) {\n    if (bubble !== false) bubble = true\n    if (baseEE.aborted && !force) { return }\n    if (old && bubble) old.emit(type, args, contextOrStore)\n    // log(\"continue...\")\n\n    var ctx = context(contextOrStore)\n    var handlersArray = listeners(type)\n    var len = handlersArray.length\n\n    // Extremely verbose debug logging\n    // if ([/^xhr/].map(function (match) {return type.match(match)}).filter(Boolean).length) {\n    //  log(type + ' args:')\n    //  log(args)\n    //  log(type + ' handlers array:')\n    //  log(handlersArray)\n    //  log(type + ' context:')\n    //  log(ctx)\n    //  log(type + ' ctxStore:')\n    //  log(ctxStore)\n    // }\n\n    // Apply each handler function in the order they were added\n    // to the context with the arguments\n\n    for (var i = 0; i < len; i++) handlersArray[i].apply(ctx, args)\n\n    // log(bufferGroupMap[type])\n    // Buffer after emitting for consistent ordering\n    var bufferGroup = getBuffer()[bufferGroupMap[type]]\n    if (bufferGroup) {\n      bufferGroup.push([emitter, type, args, ctx])\n    }\n\n    // log(bufferGroup)\n\n    // Return the context so that the module that emitted can see what was done.\n    return ctx\n  }\n\n  function addEventListener (type, fn) {\n    // Retrieve type from handlers, if it doesn't exist assign the default and retrieve it.\n    handlers[type] = listeners(type).concat(fn)\n  }\n\n  function removeEventListener (type, fn) {\n    var listeners = handlers[type]\n    if (!listeners) return\n    for (var i = 0; i < listeners.length; i++) {\n      if (listeners[i] === fn) {\n        listeners.splice(i, 1)\n      }\n    }\n  }\n\n  function listeners (type) {\n    return handlers[type] || []\n  }\n\n  function getOrCreate (name) {\n    return (emitters[name] = emitters[name] || ee(emitter, name))\n  }\n\n  function bufferEventsByGroup (types, group) {\n    var eventBuffer = getBuffer()\n\n    // do not buffer events if agent has been aborted\n    if (emitter.aborted) return\n    mapOwn(types, function (i, type) {\n      group = group || 'feature'\n      bufferGroupMap[type] = group\n      if (!(group in eventBuffer)) {\n        eventBuffer[group] = []\n      }\n    })\n  }\n\n  function isBuffering(type) {\n    var bufferGroup = getBuffer()[bufferGroupMap[type]]\n    return !!bufferGroup\n  }\n\n  // buffer is associated with a base emitter, since there are two\n  // (global and scoped to the current bundle), it is now part of the emitter\n  function getBuffer() {\n    if (old) {\n      return old.backlog\n    }\n    return emitter.backlog\n  }\n}\n\n// get context object from store object, or create if does not exist\nexport function getOrSetContext(obj) {\n  return getOrSet(obj, ctxId, getNewContext)\n}\n\nfunction getNewContext () {\n  return new EventContext()\n}\n\n// abort should be called 30 seconds after the page has started running\n// We should drop our data and stop collecting if we still have a backlog, which\n// signifies the rest of the agent wasn't loaded\nfunction abortIfNotLoaded () {\n  if (baseEE.backlog.api || baseEE.backlog.feature) {\n    baseEE.aborted = true\n    baseEE.backlog = {}\n  }\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { ee as eePkg, global } from './contextual-ee'\nexport var handleEE = eePkg.get('handle')\nexport var globalEE = global.get('handle')\n\n// Exported for register-handler to attach to.\n// export default handle\nexport { globalHandle as global }\n\nexport function handle(type, args, ctx, group, ee) {\n  if (ee) {\n    ee.buffer([type], group)\n    ee.emit(type, args, ctx)\n  } else {\n    handleEE.buffer([type], group)\n    handleEE.emit(type, args, ctx)\n  }\n}\n\nfunction globalHandle(type, args, ctx, group) {\n  globalEE.buffer([type], group)\n  globalEE.emit(type, args, ctx)\n}\n","var supportsPassive = false\ntry {\n  var opts = Object.defineProperty({}, 'passive', {\n    // eslint-disable-next-line\n    get: function() {\n      supportsPassive = true\n    }\n  })\n  window.addEventListener('testPassive', null, opts)\n  window.removeEventListener('testPassive', null, opts)\n} catch (e) {\n  // do nothing\n}\n\nexport function eventListenerOpts(useCapture) {\n  return supportsPassive ? {passive: true, capture: !!useCapture} : !!useCapture\n}\n\n// export default eventListenerOpts\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { sHash } from '../util/s-hash'\nimport { navCookie } from '../timing/start-time'\nimport { getConfigurationValue } from '../config/config'\n\n// var sHash = require('./s-hash')\n// var startTime = require('./start-time')\n\n// functions are on object, so that they can be mocked\n// var exp = {\n//   conditionallySet: conditionallySet,\n//   setCookie: setCookie\n// }\n\n// module.exports = exp\n\nexport function conditionallySet(agentIdentifier) {\n  // var areCookiesEnabled = true\n  var areCookiesEnabled = getConfigurationValue(agentIdentifier, 'privacy.cookies_enabled')\n  // if ('init' in NREUM && 'privacy' in NREUM.init) {\n  //   areCookiesEnabled = NREUM.init.privacy.cookies_enabled\n  // }\n\n  if (navCookie && areCookiesEnabled) {\n    setCookie()\n  }\n}\n\nexport function setCookie() {\n  document.cookie = 'NREUM=s=' + Number(new Date()) + '&r=' + sHash(document.location.href) + '&p=' + sHash(document.referrer) + '; path=/'\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// import { getSubmitMethod, send, sendX } from './harvest'\nimport { submitData } from '../util/submit-data'\nimport { SharedContext } from '../context/shared-context'\nimport { Harvest } from './harvest'\nimport { subscribeToUnload } from '../unload/unload'\nimport { conditionallySet } from '../cookie/nav-cookie'\n\n/**\n * Periodically invokes harvest calls and handles retries\n */\nexport class HarvestScheduler extends SharedContext {\n  constructor(endpoint, opts, parent) {\n    super(parent) // gets any allowed properties from the parent and stores them in `sharedContext`\n    this.endpoint = endpoint\n    this.opts = opts || {}\n    this.started = false\n    this.timeoutHandle = null\n\n    this.harvest = new Harvest(this.sharedContext)\n\n    subscribeToUnload(() => {\n      // if opts.onUnload is defined, these are special actions that are meant\n      // to execute before attempting to send the final payload\n      if (this.opts.onUnload) this.opts.onUnload()\n      this.harvest.sendFinal()\n      conditionallySet(this.sharedContext.agentIdentifier)\n    })\n  }\n\n  startTimer(interval, initialDelay) {\n    this.interval = interval\n    this.started = true\n    this.scheduleHarvest(initialDelay != null ? initialDelay : this.interval)\n  }\n\n  stopTimer() {\n    this.started = false\n    if (this.timeoutHandle) {\n      clearTimeout(this.timeoutHandle)\n    }\n  }\n\n  scheduleHarvest(delay, opts) {\n    if (this.timeoutHandle) return\n    var timer = this\n\n    if (delay == null) {\n      delay = this.interval\n    }\n    this.timeoutHandle = setTimeout(() => {\n      timer.timeoutHandle = null\n      timer.runHarvest(opts)\n    }, delay * 1000)\n  }\n\n  runHarvest(opts) {\n    var scheduler = this\n\n    if (this.opts.getPayload) {\n      var submitMethod = this.harvest.getSubmitMethod(this.endpoint, opts)\n      if (!submitMethod) return false\n\n      var retry = submitMethod.method === submitData.xhr\n      var payload = this.opts.getPayload({ retry: retry })\n      if (payload) {\n        payload = Object.prototype.toString.call(payload) === '[object Array]' ? payload : [payload]\n        for (var i = 0; i < payload.length; i++) {\n          this.harvest.send(this.endpoint, payload[i], opts, submitMethod, onHarvestFinished, this.sharedContext.agentIdentifier)\n        }\n      }\n    } else {\n      this.harvest.sendX(this.endpoint, opts, onHarvestFinished, this.sharedContext.agentIdentifier)\n    }\n\n    if (this.started) {\n      this.scheduleHarvest()\n    }\n\n    function onHarvestFinished(result) {\n      scheduler.onHarvestFinished(opts, result)\n    }\n  }\n\n  onHarvestFinished(opts, result) {\n    if (this.opts.onFinished) {\n      this.opts.onFinished(result)\n    }\n\n    if (result.sent && result.retry) {\n      var delay = result.delay || this.opts.retryDelay\n      // reschedule next harvest if should be delayed longer\n      if (this.started && delay) {\n        clearTimeout(this.timeoutHandle)\n        this.timeoutHandle = null\n        this.scheduleHarvest(delay, opts)\n      } else if (!this.started && delay) {\n        // if not running on a timer, schedule a single retry\n        this.scheduleHarvest(delay, opts)\n      }\n    }\n  }\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// export default {\n//   getLocation: getLocation\n// }\n\nexport function getLocation() {\n  return '' + location\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { mapOwn } from '../util/map-own'\nimport { obj as encodeObj, param as encodeParam } from '../url/encode'\nimport { stringify } from '../util/stringify'\nimport { submitData } from '../util/submit-data'\nimport { reduce } from '../util/reduce'\nimport { getLocation } from '../url/location'\nimport {getInfo, getConfigurationValue, getRuntime, getConfiguration} from '../config/config'\nimport { cleanURL } from '../url/clean-url'\nimport { now } from '../timing/now'\nimport { eventListenerOpts } from '../event-listener/event-listener-opts'\nimport { ieVersion } from '../browser-version/ie-version'\nimport { Obfuscator } from '../util/obfuscate'\nimport { applyFnToProps } from '../util/traverse'\nimport { SharedContext } from '../context/shared-context'\nimport pkg from '../../package.json'\n\nconst version = pkg.version\n// var version = '<VERSION>'\n// var jsonp = 'NREUM.setToken'\n// var _events = {}\nvar haveSendBeacon = !!navigator.sendBeacon\n\n// requiring ie version updates the IE version on the loader object\n// var ieVersion = require('./ie-version')\nexport var xhrUsable = ieVersion > 9 || ieVersion === 0\n\nexport class Harvest extends SharedContext {\n  constructor(parent) {\n    super(parent) // gets any allowed properties from the parent and stores them in `sharedContext`\n\n    this.tooManyRequestsDelay = getConfigurationValue(this.sharedContext.agentIdentifier, 'harvest.tooManyRequestsDelay') || 60\n    this.obfuscator = new Obfuscator(this.sharedContext)\n    this.getScheme = () => (getConfigurationValue(this.sharedContext.agentIdentifier, 'ssl') === false) ? 'http' : 'https'\n\n    this._events = {}\n  }\n\n  sendFinal() {\n    var sents = mapOwn(this._events, (endpoint) => {\n      return this.sendX(endpoint, { unload: true })\n    })\n    return reduce(sents, or)\n  }\n\n  sendX(endpoint, opts, cbFinished) {\n    var submitMethod = getSubmitMethod(endpoint, opts)\n    if (!submitMethod) return false\n    var options = {\n      retry: submitMethod.method === submitData.xhr\n    }\n    return this.obfuscator.shouldObfuscate() ? this.obfuscator.obfuscateAndSend(endpoint, this.createPayload(endpoint, options), opts, submitMethod, cbFinished) : this._send(endpoint, this.createPayload(endpoint, options), opts, submitMethod, cbFinished)\n  }\n\n  /**\n * Initiate a harvest call.\n *\n * @param {string} endpoint - The endpoint of the harvest (jserrors, events, resources etc.)\n * @param {object} nr - The loader singleton.\n *\n * @param {object} singlePayload - Object representing payload.\n * @param {object} singlePayload.qs - Map of values that should be sent as part of the request query string.\n * @param {string} singlePayload.body - String that should be sent as the body of the request.\n * @param {string} singlePayload.body.e - Special case of body used for browser interactions.\n *\n * @param {object} opts\n * @param {bool} opts.needResponse - Specify whether the caller expects a response data.\n * @param {bool} opts.unload - Specify whether the call is a final harvest during page unload.\n */\n  send(endpoint, singlePayload, opts, submitMethod, cbFinished) {\n    var makeBody = createAccumulator()\n    var makeQueryString = createAccumulator()\n    if (singlePayload.body) mapOwn(singlePayload.body, makeBody)\n    if (singlePayload.qs) mapOwn(singlePayload.qs, makeQueryString)\n\n    var payload = { body: makeBody(), qs: makeQueryString() }\n    var caller = this.obfuscator.shouldObfuscate() ? this.obfuscator.obfuscateAndSend : this._send\n    return caller(endpoint, payload, opts, submitMethod, cbFinished)\n  }\n\n  obfuscateAndSend(endpoint, payload, opts, submitMethod, cbFinished) {\n    applyFnToProps(payload, (...args) => this.obfuscator.obfuscateString(...args), 'string', ['e'])\n    return this._send(endpoint, payload, opts, submitMethod, cbFinished)\n  }\n\n  _send(endpoint, payload, opts, submitMethod, cbFinished) {\n    var info = getInfo(this.sharedContext.agentIdentifier)\n    if (!info.errorBeacon) return false\n\n    if (!payload.body) {\n      if (cbFinished) {\n        cbFinished({ sent: false })\n      }\n      return false\n    }\n\n    if (!opts) opts = {}\n\n    var url = this.getScheme() + '://' + info.errorBeacon + '/' + endpoint + '/1/' + info.licenseKey + this.baseQueryString()\n    if (payload.qs) url += encodeObj(payload.qs, getRuntime(this.sharedContext.agentIdentifier).maxBytes)\n\n    if (!submitMethod) {\n      submitMethod = getSubmitMethod(endpoint, opts)\n    }\n    var method = submitMethod.method\n    var useBody = submitMethod.useBody\n\n    var body\n    var fullUrl = url\n    if (useBody && endpoint === 'events') {\n      body = payload.body.e\n    } else if (useBody) {\n      body = stringify(payload.body)\n    } else {\n      fullUrl = url + encodeObj(payload.body, getRuntime(this.sharedContext.agentIdentifier).maxBytes)\n    }\n\n    var result = method(fullUrl, body)\n\n    if (cbFinished && method === submitData.xhr) {\n      var xhr = result\n      xhr.addEventListener('load', function () {\n        var result = { sent: true }\n        if (this.status === 429) {\n          result.retry = true\n          result.delay = this.tooManyRequestsDelay\n        } else if (this.status === 408 || this.status === 500 || this.status === 503) {\n          result.retry = true\n        }\n\n        if (opts.needResponse) {\n          result.responseText = this.responseText\n        }\n        cbFinished(result)\n      }, eventListenerOpts(false))\n    }\n\n    // if beacon request failed, retry with an alternative method\n    if (!result && method === submitData.beacon) {\n      method = submitData.img\n      result = method(url + encodeObj(payload.body, getRuntime(this.sharedContext.agentIdentifier).maxBytes))\n    }\n\n    return result\n  }\n\n  // The stuff that gets sent every time.\n  baseQueryString() {\n    var areCookiesEnabled = true\n    const init = getConfiguration(this.sharedContext.agentIdentifier)\n    var runtime = getRuntime(this.sharedContext.agentIdentifier)\n    var info = getInfo(this.sharedContext.agentIdentifier)\n\n    if ('privacy' in init) {\n      areCookiesEnabled = init.privacy.cookies_enabled\n    }\n\n    var location = cleanURL(getLocation())\n    var ref = this.obfuscator.shouldObfuscate() ? this.obfuscator.obfuscateString(location) : location\n\n    return ([\n      '?a=' + info.applicationID,\n      encodeParam('sa', (info.sa ? '' + info.sa : '')),\n      encodeParam('v', version),\n      transactionNameParam(info),\n      encodeParam('ct', runtime.customTransaction),\n      '&rst=' + now(),\n      '&ck=' + (areCookiesEnabled ? '1' : '0'),\n      encodeParam('ref', ref),\n      encodeParam('ptid', (runtime.ptid ? '' + runtime.ptid : ''))\n    ].join(''))\n  }\n\n  createPayload(type, options) {\n    var makeBody = createAccumulator()\n    var makeQueryString = createAccumulator()\n    var listeners = (this._events[type] && this._events[type] || [])\n\n    for (var i = 0; i < listeners.length; i++) {\n      var singlePayload = listeners[i](options)\n      if (!singlePayload) continue\n      if (singlePayload.body) mapOwn(singlePayload.body, makeBody)\n      if (singlePayload.qs) mapOwn(singlePayload.qs, makeQueryString)\n    }\n    return { body: makeBody(), qs: makeQueryString() }\n  }\n\n  on(type, listener) {\n    var listeners = (this._events[type] || (this._events[type] = []))\n    listeners.push(listener)\n  }\n\n  resetListeners() {\n    mapOwn(this._events, function (key) {\n      this._events[key] = []\n    })\n  }\n}\n\nfunction or(a, b) { return a || b }\n\n// function createPayload(type, options) {\n//   var makeBody = createAccumulator()\n//   var makeQueryString = createAccumulator()\n//   var listeners = (_events[type] && _events[type] || [])\n\n//   for (var i = 0; i < listeners.length; i++) {\n//     var singlePayload = listeners[i](options)\n//     if (!singlePayload) continue\n//     if (singlePayload.body) mapOwn(singlePayload.body, makeBody)\n//     if (singlePayload.qs) mapOwn(singlePayload.qs, makeQueryString)\n//   }\n//   return { body: makeBody(), qs: makeQueryString() }\n// }\n\nexport function getSubmitMethod(endpoint, opts) {\n  opts = opts || {}\n  var method\n  var useBody\n\n  if (opts.needResponse) {\n    if (xhrUsable) {\n      useBody = true\n      method = submitData.xhr\n    } else {\n      return false\n    }\n  } else if (opts.unload) {\n    useBody = haveSendBeacon\n    method = haveSendBeacon ? submitData.beacon : submitData.img\n  } else {\n    // `submitData.beacon` was removed, there is an upper limit to the\n    // number of data allowed before it starts failing, so we save it for\n    // unload data\n    if (xhrUsable) {\n      useBody = true\n      method = submitData.xhr\n    } else if (endpoint === 'events' || endpoint === 'jserrors') {\n      method = submitData.img\n    } else {\n      return false\n    }\n  }\n\n  return {\n    method: method,\n    useBody: useBody\n  }\n}\n\n// Constructs the transaction name param for the beacon URL.\n// Prefers the obfuscated transaction name over the plain text.\n// Falls back to making up a name.\nfunction transactionNameParam(info) {\n  if (info.transactionName) return encodeParam('to', info.transactionName)\n  return encodeParam('t', info.tNamePlain || 'Unnamed Transaction')\n}\n\n// export function on(type, listener) {\n//   var listeners = (_events[type] || (_events[type] = []))\n//   listeners.push(listener)\n// }\n\n// export function resetListeners() {\n//   mapOwn(_events, function (key) {\n//     _events[key] = []\n//   })\n// }\n\n// returns a function that can be called to accumulate values to a single object\n// when the function is called without parameters, then the accumulator is returned\nfunction createAccumulator() {\n  var accumulator = {}\n  var hasData = false\n  return function (key, val) {\n    if (val && val.length) {\n      accumulator[key] = val\n      hasData = true\n    }\n    if (hasData) return accumulator\n  }\n}\n","// traverses an object and applies a fn to property values of a certain type\nexport function applyFnToProps(obj, fn, type, ignoreKeys) {\n  if (!obj || typeof obj !== 'object') return obj\n  type = type || 'string'\n  ignoreKeys = ignoreKeys || []\n  return traverse(obj)\n  function traverse(obj) {\n    for (var property in obj) {\n      // eslint-disable-next-line\n      if (obj.hasOwnProperty(property)) {\n        if (typeof obj[property] === 'object') {\n          traverse(obj[property])\n        } else {\n          if (typeof obj[property] === type && !shouldIgnore(property)) obj[property] = fn(obj[property])\n        }\n      }\n    }\n    return obj\n  }\n\n  function shouldIgnore(key) {\n    var ignore = false\n    for (var i = 0; i < ignoreKeys.length; i++) {\n      if (ignoreKeys[i] === key) {\n        ignore = true\n        break\n      }\n    }\n    return ignore\n  }\n}\n","import { handle } from '../event-emitter/handle'\n\nvar SUPPORTABILITY_METRIC = 'sm'\nvar CUSTOM_METRIC = 'cm'\n\n/**\n * Records a supportabilityMetric (sm) using the value of a named property or as a counter without a value.\n * @param {string} name - Name of the metric, this will be used to create the parent name of the metric.\n * @param {number} [value] - The value of the metric, if none, will increment counter\n * @returns void\n */\nexport function recordSupportability(name, value) {\n  var opts = [\n    SUPPORTABILITY_METRIC,\n    name,\n    {name: name},\n    value\n  ]\n\n  handle('storeMetric', opts, null, 'api')\n  return opts\n}\n\n/**\n * Records a customMetric (cm) using the value of a named property or as a counter without a value.\n * @param {string} name - Name of the metric, this will be used to create the parent name of the metric.\n * @param {Object.<string, number>} [value] - The named property upon which to aggregate values. This will generate the substring of the metric name. If none, will incrememnt counter\n * @returns void\n */\nexport function recordCustom(name, metrics) {\n  var opts = [\n    CUSTOM_METRIC,\n    name,\n    {name: name},\n    metrics\n  ]\n\n  handle('storeEventMetrics', opts, null, 'api')\n  return opts\n}\n\nexport var constants = {SUPPORTABILITY_METRIC: SUPPORTABILITY_METRIC, CUSTOM_METRIC: CUSTOM_METRIC}\n\n// export default {\n//   constants,\n//   recordSupportability: recordSupportability,\n//   recordCustom: recordCustom\n// }\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n// Use various techniques to determine the time at which this page started and whether to capture navigation timing information\n\nimport {sHash} from '../util/s-hash'\nimport { mark } from './stopwatch'\nimport { ffVersion } from '../browser-version/firefox-version'\nimport { setOffset } from './now'\nimport { exists as performanceCheckExists } from './performance-check'\n\nexport let navCookie = true\n\nfindStartTime()\n\nexport function findStartTime () {\n  var starttime = findStartWebTiming() || findStartCookie()\n\n  if (!starttime) return\n\n  mark('starttime', starttime)\n  // Refine loader.offset\n  // offset = starttime\n  setOffset(starttime)\n}\n\n// Find the start time from the Web Timing 'performance' object.\n// http://test.w3.org/webperf/specs/NavigationTiming/\n// http://blog.chromium.org/2010/07/do-you-know-how-slow-your-web-page-is.html\nfunction findStartWebTiming () {\n  // FF 7/8 has a bug with the navigation start time, so use cookie instead of native interface\n  if (ffVersion && ffVersion < 9) return\n\n  if (performanceCheckExists) {\n    // note that we don't need to use a cookie to record navigation start time\n    navCookie = false\n    return window.performance.timing.navigationStart\n  }\n}\n\n// Find the start time based on a cookie set by Episodes in the unload handler.\nfunction findStartCookie () {\n  var aCookies = document.cookie.split(' ')\n\n  for (var i = 0; i < aCookies.length; i++) {\n    if (aCookies[i].indexOf('NREUM=') === 0) {\n      var startPage\n      var referrerPage\n      var aSubCookies = aCookies[i].substring('NREUM='.length).split('&')\n      var startTime\n      var bReferrerMatch\n\n      for (var j = 0; j < aSubCookies.length; j++) {\n        if (aSubCookies[j].indexOf('s=') === 0) {\n          startTime = aSubCookies[j].substring(2)\n        } else if (aSubCookies[j].indexOf('p=') === 0) {\n          referrerPage = aSubCookies[j].substring(2)\n          // if the sub-cookie is not the last cookie it will have a trailing ';'\n          if (referrerPage.charAt(referrerPage.length - 1) === ';') {\n            referrerPage = referrerPage.substr(0, referrerPage.length - 1)\n          }\n        } else if (aSubCookies[j].indexOf('r=') === 0) {\n          startPage = aSubCookies[j].substring(2)\n          // if the sub-cookie is not the last cookie it will have a trailing ';'\n          if (startPage.charAt(startPage.length - 1) === ';') {\n            startPage = startPage.substr(0, startPage.length - 1)\n          }\n        }\n      }\n\n      if (startPage) {\n        var docReferrer = sHash(document.referrer)\n        bReferrerMatch = (docReferrer == startPage) // eslint-disable-line\n        if (!bReferrerMatch) {\n          // Navigation did not start at the page that was just exited, check for re-load\n          // (i.e. the page just exited is the current page and the referring pages match)\n          bReferrerMatch = sHash(document.location.href) == startPage && docReferrer == referrerPage // eslint-disable-line\n        }\n      }\n      if (bReferrerMatch && startTime) {\n        var now = new Date().getTime()\n        if ((now - startTime) > 60000) {\n          return\n        }\n        return startTime\n      }\n    }\n  }\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {now, getOffset} from './now'\n\nvar marks = {}\n\n// module.exports = {\n//   mark: mark,\n//   measure: measure\n// }\n\nexport function mark (markName, markTime) {\n  if (typeof markTime === 'undefined') markTime = (now() + getOffset())\n  marks[markName] = markTime\n}\n\nexport function measure (aggregator, metricName, startMark, endMark) {\n  var start = marks[startMark]\n  var end = marks[endMark]\n\n  if (typeof start === 'undefined' || typeof end === 'undefined') return\n\n  aggregator.store('measures', metricName, { value: end - start })\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport { eventListenerOpts } from './event-listener-opts'\n\n// Safely add an event listener to window in any browser\nexport function addE (sType, callback) {\n  if ('addEventListener' in window) {\n    return window.addEventListener(sType, callback, eventListenerOpts(false))\n  } else if ('attachEvent' in window) {\n    return window.attachEvent('on' + sType, callback)\n  }\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { ffVersion } from '../browser-version/firefox-version'\nimport {single} from '../util/single'\nimport {addE} from '../event-listener/add-e'\n\n// export default subscribeToUnload\n\n// Used to subscribe a callback to when a page is being unloaded. This is used,\n// for example, to submit a final harvest.\nexport function subscribeToUnload (cb) {\n  var oneCall = single(cb)\n\n  // Firefox has a bug wherein a slow-loading resource loaded from the 'pagehide'\n  // or 'unload' event will delay the 'load' event firing on the next page load.\n  // In Firefox versions that support sendBeacon, this doesn't matter, because\n  // we'll use it instead of an image load for our final harvest.\n  //\n  // Some Safari versions never fire the 'unload' event for pages that are being\n  // put into the WebKit page cache, so we *need* to use the pagehide event for\n  // the final submission from Safari.\n  //\n  // Generally speaking, we will try to submit our final harvest from either\n  // pagehide or unload, whichever comes first, but in Firefox, we need to avoid\n  // attempting to submit from pagehide to ensure that we don't slow down loading\n  // of the next page.\n  if (!ffVersion || navigator.sendBeacon) {\n    addE('pagehide', oneCall)\n  } else {\n    addE('beforeunload', oneCall)\n  }\n  addE('unload', oneCall)\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport slice from 'lodash._slice'\n\n// export default single\n\nexport function single (fn) {\n  var called = false\n  var res\n\n  return function () {\n    if (called) return res\n    called = true\n    res = fn.apply(this, slice(arguments))\n    return res\n  }\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nvar withHash = /([^?#]*)[^#]*(#[^?]*|$).*/\nvar withoutHash = /([^?#]*)().*/\nexport function cleanURL (url, keepHash) {\n  return url.replace(keepHash ? withHash : withoutHash, '$1$2')\n}\n\n// export default cleanURL\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {mapOwn} from '../util/map-own'\nimport {stringify} from '../util/stringify'\n\n// Characters that are safe in a qs, but get encoded.\nvar charMap = {\n  '%2C': ',',\n  '%3A': ':',\n  '%2F': '/',\n  '%40': '@',\n  '%24': '$',\n  '%3B': ';'\n}\n\nvar charList = mapOwn(charMap, function (k) { return k })\nvar safeEncoded = new RegExp(charList.join('|'), 'g')\n\nfunction real (c) {\n  return charMap[c]\n}\n\n// Encode as URI Component, then unescape anything that is ok in the\n// query string position.\nexport function qs (value) {\n  if (value === null || value === undefined) return 'null'\n  return encodeURIComponent(value).replace(safeEncoded, real)\n}\n\n// export default {obj: obj, fromArray: fromArray, qs: qs, param: param}\n\nexport function fromArray (qs, maxBytes) {\n  var bytes = 0\n  for (var i = 0; i < qs.length; i++) {\n    bytes += qs[i].length\n    if (bytes > maxBytes) return qs.slice(0, i).join('')\n  }\n  return qs.join('')\n}\n\nexport function obj (payload, maxBytes) {\n  var total = 0\n  var result = ''\n\n  mapOwn(payload, function (feature, dataArray) {\n    var intermediate = []\n    var next\n    var i\n\n    if (typeof dataArray === 'string') {\n      next = '&' + feature + '=' + qs(dataArray)\n      total += next.length\n      result += next\n    } else if (dataArray.length) {\n      total += 9\n      for (i = 0; i < dataArray.length; i++) {\n        next = qs(stringify(dataArray[i]))\n        total += next.length\n        if (typeof maxBytes !== 'undefined' && total >= maxBytes) break\n        intermediate.push(next)\n      }\n      result += '&' + feature + '=%5B' + intermediate.join(',') + '%5D'\n    }\n  })\n  return result\n}\n\n// Constructs an HTTP parameter to add to the BAM router URL\nexport function param (name, value) {\n  if (value && typeof (value) === 'string') {\n    return '&' + name + '=' + qs(value)\n  }\n  return ''\n}\n","import {ee} from '../event-emitter/contextual-ee'\n\nexport class FeatureBase {\n  constructor(agentIdentifier, aggregator) {\n    this.agentIdentifier = agentIdentifier\n    this.aggregator = aggregator\n    this.ee = ee.get(agentIdentifier)\n  }\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nvar has = Object.prototype.hasOwnProperty\n\n// export default getOrSet\n\n// Always returns the current value of obj[prop], even if it has to set it first\nexport function getOrSet (obj, prop, getVal) {\n  // If the value exists return it.\n  if (has.call(obj, prop)) return obj[prop]\n\n  var val = getVal()\n\n  // Attempt to set the property so it's not enumerable\n  if (Object.defineProperty && Object.keys) {\n    try {\n      Object.defineProperty(obj, prop, {\n        value: val, // old IE inherits non-write-ability\n        writable: true,\n        enumerable: false\n      })\n\n      return val\n    } catch (e) {\n      // Can't report internal errors,\n      // because GOS is a dependency of the reporting mechanisms\n    }\n  }\n\n  // fall back to setting normally\n  obj[prop] = val\n  return val\n}\n","\nvar origWindow = window\nvar win = origWindow\n\nexport function getWindow() {\n  return win\n}\n\nexport function setWindow(x) {\n  win = x\n}\n\nexport function resetWindow() {\n  win = origWindow\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\nimport { getWindow } from '../window/win'\nimport { recordSupportability } from '../metrics/metrics'\n\nexport const protocol = {\n  isFileProtocol: isFileProtocol,\n  supportabilityMetricSent: false\n}\n\nif (isFileProtocol()) {\n  recordSupportability('Generic/FileProtocol/Detected')\n  protocol.supportabilityMetricSent = true\n}\n\nfunction isFileProtocol () {\n  var win = getWindow()\n  return !!(win.location && win.location.protocol && win.location.protocol === 'file:')\n}\n","import { getConfigurationValue } from '../config/config'\nimport { SharedContext } from '../context/shared-context'\nimport { recordSupportability } from '../metrics/metrics'\nimport { protocol } from '../url/protocol'\n\nvar fileProtocolRule = {\n  regex: /^file:\\/\\/(.*)/,\n  replacement: 'file://OBFUSCATED'\n}\n\nlet recordedSupportability = false\n\nexport class Obfuscator extends SharedContext {\n  constructor(parent) {\n    super(parent) // gets any allowed properties from the parent and stores them in `sharedContext`\n    if (!recordedSupportability) {\n      if (this.shouldObfuscate()) recordSupportability('Generic/Obfuscate/Detected')\n      if (this.shouldObfuscate() && !this.validateRules(this.getRules())) recordSupportability('Generic/Obfuscate/Invalid')\n      recordedSupportability = true\n    }\n  }\n\n  shouldObfuscate() {\n    return this.getRules().length > 0\n  }\n\n  getRules() {\n    var rules = []\n    var configRules = getConfigurationValue(this.sharedContext.agentIdentifier, 'obfuscate') || []\n\n    rules = rules.concat(configRules)\n\n    if (protocol.isFileProtocol()) rules.push(fileProtocolRule)\n    // could add additional runtime/environment-specific rules here\n\n    return rules\n  }\n\n  // takes array of rule objects, logs warning and returns false if any portion of rule is invalid\n  validateRules(rules) {\n    var invalidReplacementDetected = false\n    var invalidRegexDetected = false\n    for (var i = 0; i < rules.length; i++) {\n      if (!('regex' in rules[i])) {\n        if (console && console.warn) console.warn('An obfuscation replacement rule was detected missing a \"regex\" value.')\n        invalidRegexDetected = true\n      } else if (typeof rules[i].regex !== 'string' && !(rules[i].regex.constructor === RegExp)) {\n        if (console && console.warn) console.warn('An obfuscation replacement rule contains a \"regex\" value with an invalid type (must be a string or RegExp)')\n        invalidRegexDetected = true\n      }\n\n      var replacement = rules[i].replacement\n      if (replacement) {\n        if (typeof replacement !== 'string') {\n          if (console && console.warn) console.warn('An obfuscation replacement rule contains a \"replacement\" value with an invalid type (must be a string)')\n          invalidReplacementDetected = true\n        }\n      }\n    }\n\n    return !invalidReplacementDetected && !invalidRegexDetected\n  }\n\n  // applies all regex obfuscation rules to provided URL string and returns the result\n  obfuscateString(string, agentIdentifier) {\n    // if string is empty string, null or not a string, return unmodified\n    if (!string || typeof string !== 'string') return string\n\n    var rules = this.getRules(agentIdentifier)\n    var obfuscated = string\n\n    // apply every rule to URL string\n    for (var i = 0; i < rules.length; i++) {\n      var regex = rules[i].regex\n      var replacement = rules[i].replacement || '*'\n      obfuscated = obfuscated.replace(regex, replacement)\n    }\n    return obfuscated\n  }\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport function reduce (arr, fn, next) {\n  var i = 0\n  if (typeof next === 'undefined') {\n    next = arr[0]\n    i = 1\n  }\n\n  for (i; i < arr.length; i++) {\n    next = fn(next, arr[i])\n  }\n\n  return next\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport function sHash (s) {\n  var i\n  var h = 0\n\n  for (i = 0; i < s.length; i++) {\n    h += ((i + 1) * s.charCodeAt(i))\n  }\n  return Math.abs(h)\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {mapOwn} from './map-own'\nimport {ee} from '../event-emitter/contextual-ee'\n\nvar escapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g // eslint-disable-line\nvar meta = {\n  '\\b': '\\\\b',\n  '\\t': '\\\\t',\n  '\\n': '\\\\n',\n  '\\f': '\\\\f',\n  '\\r': '\\\\r',\n  '\"': '\\\\\"',\n  '\\\\': '\\\\\\\\'\n}\n\n// export default stringify\n\nexport function stringify (val) {\n  try {\n    return str('', {'': val})\n  } catch (e) {\n    try {\n      ee.emit('internal-error', [e])\n    } catch (err) {\n      // do nothing\n    }\n  }\n}\n\nfunction quote (string) {\n  escapable.lastIndex = 0\n  return escapable.test(string) ? '\"' + string.replace(escapable, function (a) {\n    var c = meta[a]\n    return typeof c === 'string' ? c : '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4)\n  }) + '\"' : '\"' + string + '\"'\n}\n\nfunction str (key, holder) {\n  var value = holder[key]\n\n  switch (typeof value) {\n    case 'string':\n      return quote(value)\n    case 'number':\n      return isFinite(value) ? String(value) : 'null'\n    case 'boolean':\n      return String(value)\n    case 'object':\n      if (!value) { return 'null' }\n      var partial = []\n\n      // The value is an array. Stringify every element. Use null as a placeholder\n      // for non-JSON values.\n      if (value instanceof window.Array || Object.prototype.toString.apply(value) === '[object Array]') {\n        var length = value.length\n        for (var i = 0; i < length; i += 1) {\n          partial[i] = str(i, value) || 'null'\n        }\n\n        return partial.length === 0 ? '[]' : '[' + partial.join(',') + ']'\n      }\n\n      mapOwn(value, function (k) {\n        var v = str(k, value)\n        if (v) partial.push(quote(k) + ':' + v)\n      })\n\n      return partial.length === 0 ? '{}' : '{' + partial.join(',') + '}'\n  }\n}\n","/*\n * Copyright 2020 New Relic Corporation. All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\nexport const submitData = {}\n// export default submitData\n\nsubmitData.jsonp = function jsonp (url, jsonp) {\n  var element = document.createElement('script')\n  element.type = 'text/javascript'\n  element.src = url + '&jsonp=' + jsonp\n  var firstScript = document.getElementsByTagName('script')[0]\n  firstScript.parentNode.insertBefore(element, firstScript)\n  return element\n}\n\nsubmitData.xhr = function xhr (url, body, sync) {\n  var request = new XMLHttpRequest()\n\n  request.open('POST', url, !sync)\n  try {\n    // Set cookie\n    if ('withCredentials' in request) request.withCredentials = true\n  } catch (e) {\n    // do nothing\n  }\n\n  request.setRequestHeader('content-type', 'text/plain')\n  request.send(body)\n  return request\n}\n\nsubmitData.xhrSync = function xhrSync (url, body) {\n  return submitData.xhr(url, body, true)\n}\n\nsubmitData.img = function img (url) {\n  var element = new Image()\n  element.src = url\n  return element\n}\n\nsubmitData.beacon = function (url, body) {\n  return navigator.sendBeacon(url, body)\n}\n","/**\n * Lo-Dash 2.4.1 (Custom Build) <http://lodash.com/>\n * Build: `lodash modularize modern exports=\"npm\" -o ./npm/`\n * Copyright 2012-2013 The Dojo Foundation <http://dojofoundation.org/>\n * Based on Underscore.js 1.5.2 <http://underscorejs.org/LICENSE>\n * Copyright 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n * Available under MIT license <http://lodash.com/license>\n */\n\n/**\n * Slices the `collection` from the `start` index up to, but not including,\n * the `end` index.\n *\n * Note: This function is used instead of `Array#slice` to support node lists\n * in IE < 9 and to ensure dense arrays are returned.\n *\n * @private\n * @param {Array|Object|string} collection The collection to slice.\n * @param {number} start The start index.\n * @param {number} end The end index.\n * @returns {Array} Returns the new array.\n */\nfunction slice(array, start, end) {\n  start || (start = 0);\n  if (typeof end == 'undefined') {\n    end = array ? array.length : 0;\n  }\n  var index = -1,\n      length = end - start || 0,\n      result = Array(length < 0 ? 0 : length);\n\n  while (++index < length) {\n    result[index] = array[start + index];\n  }\n  return result;\n}\n\nmodule.exports = slice;\n"],"names":["ffVersion","match","navigator","userAgent","ctxId","nr","globalInstance","ee","undefined","baseEE","EventContext","old","debugId","handlers","bufferGroupMap","emitters","emitter","on","addEventListener","removeEventListener","type","fn","listeners","i","length","splice","emit","args","contextOrStore","force","bubble","aborted","ctx","context","handlersArray","len","apply","bufferGroup","getBuffer","push","get","getOrCreate","name","buffer","bufferEventsByGroup","types","group","eventBuffer","abort","abortIfNotLoaded","isBuffering","backlog","getNewContext","concat","api","feature","handleEE","globalEE","handle","supportsPassive","opts","Object","defineProperty","window","e","eventListenerOpts","useCapture","passive","capture","conditionallySet","agentIdentifier","areCookiesEnabled","setCookie","document","cookie","Number","Date","location","href","referrer","HarvestScheduler","constructor","endpoint","parent","super","this","started","timeoutHandle","harvest","sharedContext","onUnload","sendFinal","startTimer","interval","initialDelay","scheduleHarvest","stopTimer","clearTimeout","delay","timer","setTimeout","runHarvest","scheduler","getPayload","submitMethod","getSubmitMethod","retry","method","xhr","payload","prototype","toString","call","send","onHarvestFinished","sendX","result","onFinished","sent","retryDelay","getLocation","haveSendBeacon","sendBeacon","xhrUsable","Harvest","tooManyRequestsDelay","obfuscator","getScheme","_events","sents","unload","reduce","or","cbFinished","options","shouldObfuscate","obfuscateAndSend","createPayload","_send","singlePayload","makeBody","createAccumulator","makeQueryString","body","qs","applyFnToProps","obj","ignoreKeys","traverse","property","hasOwnProperty","shouldIgnore","key","ignore","obfuscateString","info","errorBeacon","url","licenseKey","baseQueryString","encode","maxBytes","useBody","fullUrl","stringify","status","needResponse","responseText","beacon","img","init","runtime","privacy","cookies_enabled","ref","applicationID","sa","transactionNameParam","customTransaction","now","ptid","join","listener","resetListeners","a","b","transactionName","tNamePlain","accumulator","hasData","val","SUPPORTABILITY_METRIC","recordSupportability","value","navCookie","findStartTime","starttime","findStartWebTiming","performance","timing","navigationStart","findStartCookie","aCookies","split","indexOf","startPage","referrerPage","startTime","bReferrerMatch","aSubCookies","substring","j","charAt","substr","docReferrer","getTime","marks","mark","markName","markTime","measure","aggregator","metricName","startMark","endMark","start","end","store","addE","sType","callback","attachEvent","subscribeToUnload","cb","oneCall","single","res","called","arguments","withHash","withoutHash","cleanURL","keepHash","replace","charMap","charList","k","safeEncoded","RegExp","real","c","encodeURIComponent","fromArray","bytes","slice","total","dataArray","next","intermediate","param","FeatureBase","has","getOrSet","prop","getVal","keys","writable","enumerable","origWindow","win","getWindow","protocol","isFileProtocol","supportabilityMetricSent","fileProtocolRule","regex","replacement","recordedSupportability","Obfuscator","validateRules","getRules","rules","configRules","invalidReplacementDetected","invalidRegexDetected","console","warn","string","obfuscated","arr","sHash","s","h","charCodeAt","Math","abs","escapable","meta","str","err","quote","lastIndex","test","holder","isFinite","String","partial","Array","v","submitData","jsonp","element","createElement","src","firstScript","getElementsByTagName","parentNode","insertBefore","sync","request","XMLHttpRequest","open","withCredentials","setRequestHeader","xhrSync","Image","module","exports","array","index"],"sourceRoot":""}