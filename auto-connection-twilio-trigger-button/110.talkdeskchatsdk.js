"use strict";(self.webpackChunkTalkdeskChatSDK=self.webpackChunkTalkdeskChatSDK||[]).push([[110],{21879:function(t,e,r){r.d(e,{XN:function(){return defaultRegister},rP:function(){return defaultRegister}});var s=r(1883);defaultRegister.on=registerWithSpecificEmitter;var i=defaultRegister.handlers={},n=function globalRegister(t,e,r){registerWithSpecificEmitter(s.l_,n,t,e,r)}.handlers={};function defaultRegister(t,e,r,n){registerWithSpecificEmitter(n||s.EM,i,t,e,r)}function registerWithSpecificEmitter(t,e,r,i,n){if(n||(n="feature"),t||(t=s.EM),t.isBuffering(r)){var o=e[n]=e[n]||{};(o[r]=o[r]||[]).push([t,i])}else t.on(r,i)}},41374:function(t,e,r){r.d(e,{e:function(){return parseUrl}});var s={};function parseUrl(t){if(t in s)return s[t];var e=document.createElement("a"),r=window.location,i={};e.href=t,i.port=e.port;var n=e.href.split("://");!i.port&&n[1]&&(i.port=n[1].split("/")[0].split("@").pop().split(":")[1]),i.port&&"0"!==i.port||(i.port="https"===n[0]?"443":"80"),i.hostname=e.hostname||r.hostname,i.pathname=e.pathname,i.protocol=n[0],"/"!==i.pathname.charAt(0)&&(i.pathname="/"+i.pathname);var o=!e.protocol||":"===e.protocol||e.protocol===r.protocol,a=e.hostname===document.domain&&e.port===r.port;return i.sameOrigin=o&&(!e.hostname||a),"/"===i.pathname&&(s[t]=i),i}},33124:function(t,e,r){function supportsPerformanceObserver(){return"PerformanceObserver"in window&&"function"==typeof window.PerformanceObserver}r.d(e,{W:function(){return supportsPerformanceObserver}})},27110:function(t,e,r){r.r(e),r.d(e,{Aggregate:function(){return Aggregate}});var s=r(21879),i=r(44606),n=r(46303),o=r(30717),a=r(59722),h=r(89247),u=r(41374),c=r(33124),d=r(48683),g=r.n(d),p=r(80406),m=r(11249),f=r(25768),v=r(71009),l=r(41437),T=r(83707);class Aggregate extends T.W{constructor(t,e){if(super(t,e),this.ptid="",this.ignoredEvents={global:{mouseup:!0,mousedown:!0},window:{load:!0,pagehide:!0}},this.toAggregate={typing:[1e3,2e3],scrolling:[100,1e3],mousing:[1e3,2e3],touching:[1e3,2e3]},this.rename={typing:{keydown:!0,keyup:!0,keypress:!0},mousing:{mousemove:!0,mouseenter:!0,mouseleave:!0,mouseover:!0,mouseout:!0},scrolling:{scroll:!0},touching:{touchstart:!0,touchmove:!0,touchend:!0,touchcancel:!0,touchenter:!0,touchleave:!0}},this.trace={},this.nodeCount=0,this.sentTrace=null,this.harvestTimeSeconds=(0,p.Mt)(this.agentIdentifier,"stn.harvestTimeSeconds")||10,this.maxNodesPerHarvest=(0,p.Mt)(this.agentIdentifier,"stn.maxNodesPerHarvest")||1e3,this.laststart=0,(0,v.v)(),i.y0&&(0,m.O)(this.agentIdentifier).features.stn){this.storeTiming(window.performance.timing);var r=new n.o("resources",{onFinished:(...t)=>function onHarvestFinished(t){t.sent&&t.responseText&&!this.ptid&&(this.ptid=t.responseText,(0,m.O)(this.agentIdentifier).ptid=this.ptid,r.startTimer(this.harvestTimeSeconds));t.sent&&t.retry&&this.sentTrace&&((0,o.D)(this.sentTrace,(function(t,e){this.mergeSTNs(t,e)})),this.sentTrace=null)}(...t),retryDelay:(...t)=>this.harvestTimeSeconds(...t)});r.runHarvest({needResponse:!0}),r.harvest.on("resources",((...t)=>function prepareHarvest(t){if((0,l.zO)()>9e5)return r.stopTimer(),void(this.trace={});if(this.ptid&&this.nodeCount<=30)return;return this.takeSTNs(t.retry)}(...t))),(0,s.XN)("bst",((...t)=>this.storeEvent(...t)),void 0,this.ee),(0,s.XN)("bstTimer",((...t)=>this.storeTimer(...t)),void 0,this.ee),(0,s.XN)("bstResource",((...t)=>this.storeResources(...t)),void 0,this.ee),(0,s.XN)("bstHist",((...t)=>this.storeHist(...t)),void 0,this.ee),(0,s.XN)("bstXhrAgg",((...t)=>this.storeXhrAgg(...t)),void 0,this.ee),(0,s.XN)("bstApi",((...t)=>this.storeSTN(...t)),void 0,this.ee),(0,s.XN)("errorAgg",((...t)=>this.storeErrorAgg(...t)),void 0,this.ee),(0,s.XN)("pvtAdded",((...t)=>this.processPVT(...t)),void 0,this.ee)}}processPVT(t,e,r){var s={};s[t]=e,this.storeTiming(s,!0),this.hasFID(t,r)&&this.storeEvent({type:"fid",target:"document"},"document",e,e+r.fid)}storeTiming(t,e){var r,s,i,n=Date.now();for(r in t)"number"==typeof(s=t[r])&&s>0&&s<n&&(i=e?t[r]:t[r]-(0,m.O)(this.agentIdentifier).offset,this.storeSTN({n:r,s:i,e:i,o:"document",t:"timing"}))}storeTimer(t,e,r,s){var i="timer";"requestAnimationFrame"===s&&(i=s);var n={n:s,s:e,e:r,o:"window",t:i};this.storeSTN(n)}storeEvent(t,e,r,s){if(this.shouldIgnoreEvent(t,e))return!1;var i={n:this.evtName(t.type),s:r,e:s,t:"event"};try{i.o=this.evtOrigin(t.target,e)}catch(t){i.o=this.evtOrigin(null,e)}this.storeSTN(i)}evtName(t){var e=t;return(0,o.D)(this.rename,(function(r,s){t in s&&(e=r)})),e}evtOrigin(t,e){var r="unknown";if(t&&t instanceof XMLHttpRequest){var s=this.ee.context(t).params;r=s.status+" "+s.method+": "+s.host+s.pathname}else t&&"string"==typeof t.tagName&&(r=t.tagName.toLowerCase(),t.id&&(r+="#"+t.id),t.className&&(r+="."+g()(t.classList).join(".")));return"unknown"===r&&("string"==typeof e?r=e:e===document?r="document":e===window?r="window":e instanceof FileReader&&(r="FileReader")),r}storeHist(t,e,r){var s={n:"history.pushState",s:r,e:r,o:t,t:e};this.storeSTN(s)}storeResources(t){t&&0!==t.length&&(t.forEach((function(t){var e=(0,u.e)(t.name),r={n:t.initiatorType,s:0|t.fetchStart,e:0|t.responseEnd,o:e.protocol+"://"+e.hostname+":"+e.port+e.pathname,t:t.entryType};r.s<=this.laststart||this.storeSTN(r)})),this.laststart=0|t[t.length-1].fetchStart)}storeErrorAgg(t,e,r,s){if("err"===t){var i={n:"error",s:s.time,e:s.time,o:r.message,t:r.stackHash};this.storeSTN(i)}}storeXhrAgg(t,e,r,s){if("xhr"===t){var i={n:"Ajax",s:s.time,e:s.time+s.duration,o:r.status+" "+r.method+": "+r.host+r.pathname,t:"ajax"};this.storeSTN(i)}}storeSTN(t){if(!(this.nodeCount>=this.maxNodesPerHarvest)){var e=this.trace[t.n];e||(e=this.trace[t.n]=[]),e.push(t),this.nodeCount++}}mergeSTNs(t,e){if(!(this.nodeCount>=this.maxNodesPerHarvest)){var r=this.trace[t];r||(r=this.trace[t]=[]),this.trace[t]=e.concat(r),this.nodeCount+=e.length}}takeSTNs(t){(0,c.W)()||this.storeResources(window.performance.getEntriesByType("resource"));var e=(0,a.u)((0,o.D)(this.trace,(function(t,e){return t in this.toAggregate?(0,a.u)((0,o.D)((0,a.u)(e.sort(this.byStart),this.smearEvtsByOrigin(t),{}),this.val),this.flatten,[]):e})),this.flatten,[]);if(0===e.length)return{};t&&(this.sentTrace=this.trace),this.trace={},this.nodeCount=0;var r={qs:{st:""+(0,m.O)(this.agentIdentifier).offset},body:{res:e}};if(!this.ptid){const{userAttributes:t,atts:e,jsAttributes:i}=(0,f.C)(this.agentIdentifier);r.qs.ua=t,r.qs.at=e;var s=(0,h.P)(i);r.qs.ja="{}"===s?null:s}return r}byStart(t,e){return t.s-e.s}smearEvtsByOrigin(t){var e=this.toAggregate[t][0],r=this.toAggregate[t][1],s={};return function(i,n){var o=i[n.o];o||(o=i[n.o]=[]);var a=s[n.o];return"scrolling"!==t||this.trivial(n)?a&&n.s-a.s<r&&a.e>n.s-e?a.e=n.e:(s[n.o]=n,o.push(n)):(s[n.o]=null,n.n="scroll",o.push(n)),i}}val(t,e){return e}flatten(t,e){return t.concat(e)}hasFID(t,e){return"fi"===t&&!!e&&"number"==typeof e.fid}trivial(t){return!!(t&&"number"==typeof t.e&&"number"==typeof t.s&&t.e-t.s<4)}shouldIgnoreEvent(t,e){var r=this.evtOrigin(t.target,e);return t.type in this.ignoredEvents.global||!(!this.ignoredEvents[r]||!(t.type in this.ignoredEvents[r]))}}}}]);
//# sourceMappingURL=110.talkdeskchatsdk.js.map